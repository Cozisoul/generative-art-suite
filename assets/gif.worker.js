// gif.worker.js 0.2.0 - https://github.com/jnordberg/gif.js (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var GIFEncoder,renderFrame;GIFEncoder=require("./GIFEncoder.js");renderFrame=function(frame){var encoder,page,stream,transfer;encoder=new GIFEncoder(frame.width,frame.height);if(frame.index===0){encoder.setRepeat(frame.repeat);encoder.setDelay(frame.delay);encoder.setQuality(frame.quality);encoder.setDither(frame.dither);encoder.setGlobalPalette(frame.globalPalette)}else{encoder.setProperties(true,frame.globalPalette);encoder.setDelay(frame.delay);encoder.setDispose(frame.dispose);encoder.setTransparent(frame.transparent)}encoder.addFrame(frame.data);if(frame.last){encoder.finish()}if(frame.globalPalette===true){frame.globalPalette=encoder.getGlobalPalette()}stream=encoder.stream();transfer=[stream.bin.buffer];return page={index:frame.index,last:frame.last,delay:frame.delay,dispose:frame.dispose,transparent:frame.transparent,width:frame.width,height:frame.height,quality:frame.quality,dither:frame.dither,globalPalette:frame.globalPalette,data:stream.bin},[page,transfer]};exports.onmessage=function(event){return postMessage.apply(null,renderFrame(event.data))}},{"./GIFEncoder.js":4}],2:[function(require,module,exports){var LZWEncoder;LZWEncoder=function(){function LZWEncoder(width,height,pixels,color_depth){var a_count,accum,clear_flg,codetab,cur_accum,cur_bits,cur_pixel,eof,free_ent,g_init_bits,htab,i,init_code_size,maxcode,n_bits,out,remaining;this.width=width;this.height=height;this.pixels=pixels;this.color_depth=color_depth;this.init_code_size=Math.max(2,this.color_depth);this.accum=new Uint8Array(256);this.htab=new Int32Array(5003);this.codetab=new Int32Array(5003);this.cur_pixel=0;this.n_bits=void 0;this.clear_flg=false;this.g_init_bits=void 0;this.maxcode=void 0;this.eof=-1;this.free_ent=0;this.a_count=void 0;this.remaining=this.width*this.height;this.cur_accum=void 0;this.cur_bits=0;this.out=null}LZWEncoder.prototype.char_out=function(c){this.accum[this.a_count++]=c;if(this.a_count>=254){return this.flush_char()}};LZWEncoder.prototype.cl_block=function(){this.cl_hash(5003);this.free_ent=this.clear_code+2;return this.clear_flg=true};LZWEncoder.prototype.cl_hash=function(hsize){var fcode,i,j;i=0;while(i<hsize){j=i++;this.htab[j]=-1}};LZWEncoder.prototype.compress=function(init_bits){var c,clear_code,disp,ent,fcode,hshift,i,k,next_pixel;this.g_init_bits=init_bits;this.clear_flg=false;this.n_bits=this.g_init_bits;this.maxcode=this.MAXCODE(this.n_bits);this.clear_code=1<<init_bits-1;this.eof_code=this.clear_code+1;this.free_ent=this.clear_code+2;this.a_count=0;ent=this.next_pixel();hshift=0;fcode=5003;while(fcode>0){fcode-=1;hshift+=1}hshift=8-hshift;this.cl_hash(5003);this.output(this.clear_code);while((c=this.next_pixel())!==this.eof){fcode=(c<<this.n_bits)+ent;i=c<<hshift^ent;if(this.htab[i]===fcode){ent=this.codetab[i];continue}else if(this.htab[i]>=0){disp=5003-i;if(i===0){disp=1}while(true){i-=disp;if(i<0){i+=5003}if(this.htab[i]===fcode){ent=this.codetab[i];break}if(this.htab[i]<0){break}}}this.output(ent);ent=c;if(this.free_ent<1<<12){this.codetab[i]=this.free_ent++;this.htab[i]=fcode}else{this.cl_block()}}this.output(ent);this.output(this.eof_code)};LZWEncoder.prototype.encode=function(out){this.out=out;this.out.writeByte(this.init_code_size);this.remaining=this.width*this.height;this.cur_pixel=0;this.compress(this.init_code_size+1);this.out.writeByte(0)};LZWEncoder.prototype.flush_char=function(){if(this.a_count>0){this.out.writeByte(this.a_count);this.out.writeBytes(this.accum,0,this.a_count);this.a_count=0}};LZWEncoder.prototype.MAXCODE=function(n_bits){return(1<<n_bits)-1};LZWEncoder.prototype.next_pixel=function(){if(this.remaining===0){return this.eof}this.remaining--;return this.pixels[this.cur_pixel++]&255};LZWEncoder.prototype.output=function(code){this.cur_accum&=65535[code];this.cur_bits+=this.n_bits;while(this.cur_bits>=8){this.char_out(this.cur_accum&255);this.cur_accum>>=8;this.cur_bits-=8}if(this.free_ent>this.maxcode||this.clear_flg){if(this.clear_flg){this.n_bits=this.g_init_bits;this.maxcode=this.MAXCODE(this.n_bits);this.clear_flg=false}else{this.n_bits++;if(this.n_bits===12){this.maxcode=1<<12}else{this.maxcode=this.MAXCODE(this.n_bits)}}}if(code===this.eof_code){while(this.cur_bits>0){this.char_out(this.cur_accum&255);this.cur_accum>>=8;this.cur_bits-=8}this.flush_char()}};return LZWEncoder}();module.exports=LZWEncoder},{}],3:[function(require,module,exports){var NeuQuant;NeuQuant=function(){function NeuQuant(pixels,samplefac){var network;this.pixels=pixels;this.samplefac=samplefac;this.network=network=new Array(256);this.netindex=new Int32Array(256);this.bias=new Int32Array(256);this.freq=new Int32Array(256);this.radpower=new Int32Array(32);this.alphadec=30+(this.samplefac-1)/3;this.lengthcount=this.pixels.length;this.samplepixels=this.lengthcount/(3*this.samplefac);this.delta=~~(this.samplepixels/100);this.initalpha=1<<10;this.initradius=256>>6;this.radiusdec=this.delta?~~(30*((1<<6)-this.initradius)/this.delta):0;this.radbias=1<<14;this.alpharadbias=this.initalpha*this.radbias;this.initrad=this.initradius;this.buildColormap()}NeuQuant.prototype.buildColormap=function(){this.learn();this.unbiasnet();this.inxbuild();return this.network};NeuQuant.prototype.getColormap=function(){var b,g,map,r;map=new Uint8Array(768);r=void 0;g=void 0;b=void 0;i=0;j=0;while(i<256){b=this.network[i];i++;map[j++]=b[0];map[j++]=b[1];map[j++]=b[2]}return map};NeuQuant.prototype.lookupRGB=function(b,g,r){return this.inxsearch(b,g,r)};NeuQuant.prototype.unbiasnet=function(){var b,g,i,r;i=0;while(i<256){b=this.network[i];b[0]>>=4;b[1]>>=4;b[2]>>=4;b[3]=i++;continue}};NeuQuant.prototype.altersingle=function(alpha,i,b,g,r){var n;n=this.network[i];n[0]-=alpha*(n[0]-b)/this.initalpha;n[1]-=alpha*(n[1]-g)/this.initalpha;return n[2]-=alpha*(n[2]-r)/this.initalpha};NeuQuant.prototype.alterneigh=function(radius,i,b,g,r){var a,hi,j,k,lo,m,n,p;lo=Math.abs(i-radius);hi=Math.min(i+radius,256);j=i+1;k=i-1;m=1;while(j<hi||k>lo){a=this.radpower[m++];if(j<hi){p=this.network[j++];p[0]-=a*(p[0]-b)/this.alpharadbias;p[1]-=a*(p[1]-g)/this.alpharadbias;p[2]-=a*(p[2]-r)/this.alpharadbias}if(k>lo){p=this.network[k--];p[0]-=a*(p[0]-b)/this.alpharadbias;p[1]-=a*(p[1]-g)/this.alpharadbias;p[2]-=a*(p[2]-r)/this.alpharadbias}}};NeuQuant.prototype.contest=function(b,g,r){var best,bestbias,bestd,bestpos,bias,biasd,dist,i,n;bestd=~(1<<31);bestbias=bestd;bestpos=-1;bestbiaspos=bestpos;i=0;while(i<256){n=this.network[i];dist=n[0]-b;if(dist<0){dist=-dist}bias=n[1]-g;if(bias<0){bias=-bias}dist+=bias;bias=n[2]-r;if(bias<0){bias=-bias}dist+=bias;if(dist<bestd){bestd=dist;bestpos=i}biasd=dist-(this.bias[i]>>12);if(biasd<bestbias){bestbias=biasd;bestbiaspos=i}bias=this.freq[i]>>10;this.freq[i]-=bias;this.bias[i]+=bias<<10;i++}this.freq[bestpos]+=1<<10;this.bias[bestpos]-=1<<18;return bestbiaspos};NeuQuant.prototype.inxbuild=function(){var i,j,p,q,smallpos,smallval;i=0;previouscol=0;startpos=0;while(i<256){p=this.network[i];smallpos=i;smallval=p[1];j=i+1;while(j<256){q=this.network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}j++}q=this.network[smallpos];if(i!==smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!==previouscol){this.netindex[previouscol]=startpos+i>>1;j=previouscol+1;while(j<smallval){this.netindex[j]=i;j++}previouscol=smallval;startpos=i}i++}this.netindex[previouscol]=startpos+255>>1;j=previouscol+1;while(j<256){this.netindex[j]=255;j++}};NeuQuant.prototype.inxsearch=function(b,g,r){var a,best,bestd,dist,i,j,p;bestd=1e3;best=-1;i=this.netindex[g];j=i-1;while(i<256||j>=0){if(i<256){p=this.network[i];dist=p[1]-g;if(dist>=bestd){i=256}else{i++;if(dist<0){dist=-dist}a=p[0]-b;if(a<0){a=-a}dist+=a;if(dist<bestd){a=p[2]-r;if(a<0){a=-a}dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=this.network[j];dist=g-p[1];if(dist>=bestd){j=-1}else{j--;if(dist<0){dist=-dist}a=p[0]-b;if(a<0){a=-a}dist+=a;if(dist<bestd){a=p[2]-r;if(a<0){a=-a}dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best};NeuQuant.prototype.learn=function(){var a,alpha,b,g,i,j,p,pix,r,rad,radius,step;this.lengthcount=this.pixels.length;this.samplepixels=this.lengthcount/(3*this.samplefac);this.delta=~~(this.samplepixels/100);this.alphadec=30+(this.samplefac-1)/3;i=0;while(i<256){a=this.network[i]=new Array(4);a[0]=a[1]=a[2]=(i<<12)/256;this.freq[i]=1<<10;this.bias[i]=0;i++}if(this.lengthcount<900){this.samplefac=1}alpha=this.initalpha;radius=this.initradius;rad=radius>>6;if(rad<=1){rad=0}i=0;while(i<rad){this.radpower[i]=alpha*((rad*rad-i*i)*this.radbias/rad*rad);i++}if(this.lengthcount<900){step=3}else if(this.lengthcount%499!==0){step=1497}else if(this.lengthcount%491!==0){step=1473}else if(this.lengthcount%487!==0){step=1461}else{step=1501}i=0;pix=this.pixels;p=0;while(i<this.samplepixels){b=pix[p+0]&255<<4;g=pix[p+1]&255<<4;r=pix[p+2]&255<<4;j=this.contest(b,g,r);this.altersingle(alpha,j,b,g,r);if(rad!==0){this.alterneigh(rad,j,b,g,r)}p+=step;if(p>=this.lengthcount){p-=this.lengthcount}i++;if(this.delta===0){this.delta=1}if(i%this.delta===0){alpha-=alpha/this.alphadec;radius-=radius/this.radiusdec;rad=radius>>6;if(rad<=1){rad=0}j=0;while(j<rad){this.radpower[j]=alpha*((rad*rad-j*j)*this.radbias/rad*rad);j++}}}};return NeuQuant}();exports.NeuQuant=NeuQuant},{}],4:[function(require,module,exports){var ByteArray,GIFEncoder,LZWEncoder,NeuQuant;LZWEncoder=require("./LZWEncoder.js");NeuQuant=require("./TypedNeuQuant.js").NeuQuant;ByteArray=function(){function ByteArray(){this.page=-1;this.pages=[];this.newPage()}ByteArray.prototype.newPage=function(){this.pages[++this.page]={};this.pages[this.page].cursor=0;return this.pages[this.page].data=new Uint8Array(8192)};ByteArray.prototype.getData=function(){var i,rv;rv="";i=0;while(i<this.pages.length){rv+=String.fromCharCode.apply(null,this.pages[i].data);i++}return rv};ByteArray.prototype.writeByte=function(val){if(this.pages[this.page].cursor>=8192){this.newPage()}return this.pages[this.page].data[this.pages[this.page].cursor++]=val};ByteArray.prototype.writeUTFBytes=function(string){var c,i;i=0;while(i<string.length){c=string.charCodeAt(i++);this.writeByte(c)}return null};ByteArray.prototype.writeBytes=function(array,offset,length){var c,i,l;i=offset||0;l=length||array.length;while(i<l){c=array[i++];this.writeByte(c)}return null};return ByteArray}();GIFEncoder=function(){function GIFEncoder(width,height){var i;this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.image=null;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.neuQuant=null;this.usedEntry=new Array;this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;this.dither=false;this.globalPalette=false;this.out=new ByteArray}GIFEncoder.prototype.setDelay=function(ms){return this.delay=~~(ms/10)};GIFEncoder.prototype.setFrameRate=function(fps){return this.delay=~~(100/fps)};GIFEncoder.prototype.setDispose=function(code){if(code>=0){return this.dispose=code}};GIFEncoder.prototype.setRepeat=function(repeat){return this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){return this.transparent=color};GIFEncoder.prototype.addFrame=function(imageData){var k;this.image=imageData;this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null;this.getImagePixels();this.analyzePixels();if(this.globalPalette===true){this.globalPalette=this.colorTab}if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame&&!this.globalPalette){this.writePalette()}this.writePixels();return this.firstFrame=false};GIFEncoder.prototype.finish=function(){return this.out.writeByte(59)};GIFEncoder.prototype.setQuality=function(quality){if(quality<1){quality=1}return this.sample=quality};GIFEncoder.prototype.setDither=function(dither){if(dither===true){dither="FloydSteinberg"}return this.dither=dither};GIFEncoder.prototype.setGlobalPalette=function(palette){return this.globalPalette=palette};GIFEncoder.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette};GIFEncoder.prototype.writeHeader=function(){return this.out.writeUTFBytes("GIF89a")};GIFEncoder.prototype.analyzePixels=function(){var i,j,len;if(!this.colorTab){this.neuQuant=new NeuQuant(this.pixels,this.sample);this.neuQuant.buildColormap();this.colorTab=this.neuQuant.getColormap()}if(this.dither){this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null)}else{this.indexPixels()}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){return this.transIndex=this.findClosest(this.transparent,true)}};GIFEncoder.prototype.indexPixels=function(imgq){var i,j,k,nPix;nPix=this.pixels.length/3;this.indexedPixels=new Uint8Array(nPix);k=0;j=0;i=0;while(i<nPix){this.indexedPixels[i++]=this.findClosestRGB(this.pixels[j++]&255,this.pixels[j++]&255,this.pixels[j++]&255)}};GIFEncoder.prototype.ditherPixels=function(kernel,serpentine){var b,g,i,j,k,l,m,n,new_b,new_g,new_r,nerr,p,quant_err,r,w,x,y;k=kernel==="FloydSteinberg"?[[0,0,0,7/16,3/16,5/16,1/16]]:kernel==="FalseFloydSteinberg"?[[0,0,0,3/8,3/8,2/8,0]]:kernel==="Stucki"?[[0,0,0,0,0,8/42,4/42,2/42,4/42,8/42,4/42,2/42]]:kernel==="Atkinson"?[[0,0,0,0,1/8,1/8,1/8,1/8,1/8,0]]:[[0,0,0,0,0,1,1,1,1,1,1,0].map(function(i){return i/8})];l=this.pixels;m=l.length;n=this.width;p=new Int16Array(m);i=0;while(i<m){p[i]=l[i]<<4;i++}i=0;while(i<m/3){if(serpentine&&i/n%2===1){j=i*3+n-1;r=p[j-3];g=p[j-2];b=p[j-1]}else{j=i*3;r=p[j];g=p[j+1];b=p[j+2]}r=~~(r/16);g=~~(g/16);b=~~(b/16);this.indexedPixels[i]=this.findClosestRGB(r,g,b);quant_err=[l[j]-r,l[j+1]-g,l[j+2]-b];y=0;while(y<k.length){x=0;while(x<k[y].length){w=k[y][x];if(w===0){x++;continue}new_r=r;new_g=g;new_b=b;if(serpentine&&i/n%2===1){if(x%2===0){new_r-=n}else{new_r+=n}}else if(x%2===0){new_r+=n}else{new_r-=n}if(y%2===0){new_r+=1}else{new_r-=1}if(new_r>=0&&new_r<m/3){nerr=p[new_r];nerr[0]+=quant_err[0]*w;nerr[1]+=quant_err[1]*w;nerr[2]+=quant_err[2]*w}x++}y++}i++}};GIFEncoder.prototype.findClosest=function(c,used){return this.findClosestRGB((c&16711680)>>16,(c&65280)>>8,c&255,used)};GIFEncoder.prototype.findClosestRGB=function(r,g,b,used){var c,dmin,i,index,len,minpos;if(this.colorTab===null){return-1}if(this.neuQuant&&!used){return this.neuQuant.lookupRGB(b,g,r)}c=b|g<<8|r<<16;minpos=0;dmin=256*256*256;len=this.colorTab.length;i=0;index=0;while(i<len){d=Math.abs((this.colorTab[i++]&255)-b)+Math.abs((this.colorTab[i++]&255)-g)+Math.abs((this.colorTab[i++]&255)-r);if(d<dmin){dmin=d;minpos=index}index++}return minpos};GIFEncoder.prototype.getImagePixels=function(){var h,i,j,w;w=this.width;h=this.height;this.pixels=new Uint8Array(w*h*3);j=this.image;k=0;i=0;while(i<h){l=0;while(l<w){this.pixels[k++]=j[i*w*4+l*4+0];this.pixels[k++]=j[i*w*4+l*4+1];this.pixels[k++]=j[i*w*4+l*4+2];l++}i++}};GIFEncoder.prototype.writeGraphicCtrlExt=function(){var disp,transp;this.out.writeByte(33);this.out.writeByte(249);this.out.writeByte(4);transp=0;disp=0;if(this.transparent!==null){transp=1;disp=2}if(this.dispose>=0){disp=this.dispose&7}disp<<=2;this.out.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.out.writeByte(this.transIndex);return this.out.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.out.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame||this.globalPalette){return this.out.writeByte(0)}else{return this.out.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.out.writeByte(128|112|0|this.palSize);this.out.writeByte(0);return this.out.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.out.writeByte(33);this.out.writeByte(255);this.out.writeByte(11);this.out.writeUTFBytes("NETSCAPE2.0");this.out.writeByte(3);this.out.writeByte(1);this.writeShort(this.repeat);return this.out.writeByte(0)};GIFEncoder.prototype.writePalette=function(){var i,n;this.out.writeBytes(this.colorTab);n=3*256-this.colorTab.length;i=0;while(i<n){this.out.writeByte(0);i++}};GIFEncoder.prototype.writeShort=function(pValue){this.out.writeByte(pValue&255);return this.out.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc;enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);return enc.encode(this.out)};GIFEncoder.prototype.stream=function(){return this.out};return GIFEncoder}();module.exports=GIFEncoder},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],5:[function(require,module,exports){var NeuQuant=require("./TypedNeuQuant.js").NeuQuant,GIFEncoder=require("./GIFEncoder.js"),renderFrame=function(frame){var encoder,page,stream,transfer;encoder=new GIFEncoder(frame.width,frame.height);if(frame.index===0){encoder.setRepeat(frame.repeat);encoder.setDelay(frame.delay);encoder.setQuality(frame.quality);encoder.setDither(frame.dither);encoder.setGlobalPalette(frame.globalPalette)}else{encoder.setProperties(true,frame.globalPalette);encoder.setDelay(frame.delay);encoder.setDispose(frame.dispose);encoder.setTransparent(frame.transparent)}encoder.addFrame(frame.data);if(frame.last){encoder.finish()}if(frame.globalPalette===true){frame.globalPalette=encoder.getGlobalPalette()}stream=encoder.stream();transfer=[stream.bin.buffer];return page={index:frame.index,last:frame.last,delay:frame.delay,dispose:frame.dispose,transparent:frame.transparent,width:frame.width,height:frame.height,quality:frame.quality,dither:frame.dither,globalPalette:frame.globalPalette,data:stream.bin},[page,transfer]};onmessage=function(event){return postMessage.apply(null,renderFrame(event.data))}},{"./GIFEncoder.js":1,"./TypedNeuquant.js":3}]},{},[5]);